[
  {
    "query": "select * from `films`",
    "output": {
      "collection": "films",
      "limit": 100
    }
  },
  {
    "query": "select Title,Description from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "Title" : 1,
        "Description": 1
      }
    }
  },
  {
    "query": "select Title as Name,Description from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "Name" : "$Title",
        "Description": 1
      }
    }
  },
  {
    "query": "SELECT * FROM customers WHERE `Address.Country`='Japan' ORDER BY id desc",
    "output": {
      "collection": "customers",
      "limit": 100,
      "query": { "Address.Country": {
        "$eq": "Japan" }},
      "sort": { "id" : -1 }
    }

  },
  {
    "query": "select `Replacement Value` as Value,Description from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "Value" : "$Replacement Value",
        "Description": 1
      }
    }
  },
  {
    "query": "select Title as Name,Description from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "Name" : "$Title",
        "Description": 1
      }
    }
  },
  {
    "query": "select 'Name' as Id,Description from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "Id" : { "$literal": "Name" },
        "Description": 1
      }
    }
  },
  {
    "query": "select cast(abs(`id`) as decimal) as `id` from `customers`",
    "output": {
      "collection": "customers",
      "limit": 100,
      "projection": {
        "id": {
          "$convert": {
            "input": {
              "$abs": "$id"
            },
            "to": "decimal"
          }
        }
      }
    }
  },
  {
    "query": "select cast('123' as int) as `id` from `customers`",
    "output": {
      "collection": "customers",
      "limit": 100,
      "projection": {
        "id": {
          "$convert": {
            "input": "123",
            "to": "int"
          }
        }
      }
    }
  },
  {
    "query": "select cast(1+`id` as varchar) as `id` from `customers`",
    "output": {"limit":100,"collection":"customers","projection":{"id":{"$convert":{"input":{"$add":[1,"$id"]},"to":"string"}}}}

  },

  {
    "query": "select sum(`Replacement Cost`,2)  from `films`",
    "error": "Requires as for function:sum"
  },
  {
    "query": "select sum(`Replacement Cost`,2,id) as s from `films`",
    "output": {
      "collection": "films",
      "limit": 100,
      "projection": {
        "s": {
          "$add": [
            "$Replacement Cost",
            {
              "$literal": 2
            },
            "$id"
          ]
        }
      }
    }
  },
  {
    "query": "select `Address.City` as City ,`First Name` as Name from `customers` where `id`>1 limit 10 offset 5",
    "output": {
      "collection": "customers",
      "limit": 10,
      "skip": 5,
      "projection": {
        "City": "$Address.City",
        "Name": "$First Name"
      },
      "query": {
        "id": { "$gt": 1 }

      }
    }
  },
  {
    "query": "select `First Name` as Name,arrayFirst(`Rentals`) as Rental from `customers` where `id`>1 limit 10 offset 5",
    "output": {
      "collection": "customers",
      "limit": 10,
      "skip": 5,
      "projection": {
        "Rental": {
          "$first": "$Rentals"
        },
        "Name": "$First Name"
      },
      "query": {
        "id": { "$gt": 1 }

      }
    }
  },
  {
    "query": "select subtract(convert('1','int'),abs(`Replacement Cost`)) as d,Title from `films`",
    "output": {"limit":100,"collection":"films","projection":{"d":{"$subtract":[{"$convert":{"input":{"$literal":"1"},"to":"int"}},{"$abs":"$Replacement Cost"}]},"Title":1}}

    },
  {
    "query": "SELECT * FROM customers WHERE `First Name` like '%bc%'",
    "output": {
      "limit": 100,
      "collection": "customers",
      "query": { "First Name": { "$regex": "bc", "$options": "i" } }}
  },
  {
    "query": "SELECT * FROM customers WHERE `First Name` like '%bc%' limit 10 offset 2",
    "output": {
      "limit": 10,
      "skip": 2,
      "collection": "customers",
      "query": { "First Name": { "$regex": "bc", "$options": "i" } }}
  },
  {
    "query": "SELECT abs(id + lengthOfArray(Rentals) + 1) as testComplex FROM customers WHERE `First Name` like '%bc%'",
    "output": {
      "limit": 100,
      "collection": "customers",
      "query": {
        "First Name": {
          "$regex": "bc",
          "$options": "i"
        }
      },
      "projection": {
        "testComplex": {
          "$abs": {
            "$add": [
              {
                "$add": [
                  "$id",
                  {
                    "$size": "$Rentals"
                  }
                ]
              },
              1
            ]
          }
        }
      }
    }
  },
  {
    "query": "SELECT ceiling(id + lengthOfArray(Rentals) + 1) as testComplex FROM customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {
        "testComplex": {
        "$ceil": {
          "$add": [
            {
              "$add": [
                "$id",
                {
                  "$size": "$Rentals"
                }
              ]
            },
            1
          ]
        }
      }
    }
    }
  },
  {
    "query": "select * from `films` where id<90 and (id>10 or id=5)",
    "output": {
      "limit": 100,
      "collection": "films",
      "query": {
        "id": {
          "$lt": 90
        },
        "$or": [
          {
            "id": {
              "$gt": 10
            }
          },
          {
            "id": {
              "$eq": 5
            }
          }
        ]
      }
      }
    },
  {
    "query": "select sum(id) as d from `customers`",
    "error": "Query cannot cross multiple collections, have an aggregate function or contain functions in where clauses"
  },
  {
    "query": "select id,`First Name`,`Last Name`,sumArray(`Rentals`,`Payments`,'Amount') as totalPayments from customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {
        "id":1,
        "First Name":1,
        "Last Name":1,
        "totalPayments":{
          "$reduce":{
          "input": "$Rentals",
          "initialValue": 0,
          "in": {
            "$sum": ["$$value",{
              "$reduce":{
                "input": "$$this.Payments",
                "initialValue": 0,
                "in": {
                  "$sum": ["$$value", "$$this.Amount" ]
                }
              }
            }]}
        }
        }
      }
    }
  },
  {
    "query": "select id,`First Name`,`Last Name`,sumArray(`Rentals`,'filmId') as totalIdRentals from customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {
        "id":1,
        "First Name":1,
        "Last Name":1,
        "totalIdRentals":{
          "$reduce":{
            "input": "$Rentals",
            "initialValue": 0,
            "in": {
              "$sum": ["$$value","$$this.filmId"]}
          }
        }
      }
    }
  },
  {
    "query": "select sumArray((select sumArray(`Payments`,'Amount') as total from `Rentals`),'total') as t from customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {"t":{"$reduce":{"input":{"$map":{"input":"$Rentals","in":{"total":{"$reduce":{"input":"$$this.Payments","initialValue":
      0,"in":{"$sum":["$$value","$$this.Amount"]}}}}}},"initialValue":0,"in":{"$sum":["$$value","$$this.total"]}}}}

    }
  },
  {
    "query": "select id,(select `Film Title` as Title,sumArray(`Payments`,'Amount') as totalPayment from `Rentals`) as Rentals from customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {"id":1,"Rentals":{"$map":{"input":"$Rentals","in":{"Title":"$$this.Film Title","totalPayment":{"$reduce":{"input":"$$this.Payments","initialValue":0,"in":{"$sum":["$$value","$$this.Amount"]}}}}}}}

    }
  },
  {
    "query": "select id,firstInArray(select `Film Title` as Title,sumArray(`Payments`,'Amount') as totalPayment from `Rentals`) as Rental from customers",
    "output": {
      "limit": 100,
      "collection": "customers",
      "projection": {"id":1,"Rental":{"$first":{"$map":{"input":"$Rentals","in":{"Title":"$$this.Film Title","totalPayment":{"$reduce":{"input":"$$this.Payments","initialValue":0,"in":{"$sum":["$$value","$$this.Amount"]}}}}}}}}



    }
  }




]


